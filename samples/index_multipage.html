<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title></title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link rel="stylesheet"
	  href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.0/styles/atom-one-dark.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.0/highlight.min.js"></script>
</head>
<style>
	body {
		box-sizing: border-box;
		min-width: 200px;
		max-width: 980px;
		margin: 0 auto;
		padding: 45px;
	}
</style>
<body>	
	<div id="content"></div>
<script>
	function getMDPath() {
		return [
			location.origin
			,location.search.replace(/^\?/, '')
			];
	};

	const renderer = {
  		link(href, title, text) {
			title =  title == null ? '' : '" title="'+ title
			if (href.search(/:[0-9]*\/\//) >= 0) {
				return '<a href="' + href + title + '">' + text + '</a>';
			} else {
				//return '<a href="?' +  baseUrl + href + title + '">' + text + '</a>';
				return '<a href="?' +  baseUrl + href + title + '" onclick="getMD(\"'+  baseUrl + href +'\"); return false;">' + text + '</a>';
			}
  		}
	};
	marked.use({ renderer });

	callback = function() {
			document.getElementById('content').innerHTML = marked(this.responseText, {
				//renderer: new marked.Renderer(),
				highlight: function(code, language) {
					var validLanguage = hljs.getLanguage(language) ? language : 'plaintext';
					return '<code class="hljs handlebars">' + hljs.highlight(validLanguage, code).value + '</code>';
					// return '<code class="hljs handlebars">' + hljs.highlightAuto(code).value
				},
				pedantic: false,
				gfm: true,
				breaks: false,
				sanitize: false,
				smartLists: true,
				smartypants: false,
				xhtml: false,
				baseUrl: baseUrl
				});	
				MathJax.typesetPromise() // re-render Math
		}

	getMD = function(mdpath) {
		var oReq = new XMLHttpRequest();
		oReq.addEventListener("load"
		, callback
	);
	oReq.open("GET", mdpath);
	oReq.send();
	}

</script>
<script>
	var [ URL,  mdpath] = getMDPath() 
	if (mdpath=='') {
		mdpath= 'sample.md'
	}
	var baseUrl = 'md/'
	getMD(mdpath)

  </script>
  <a  href="sample.md">a link</a>
</body>
</html>